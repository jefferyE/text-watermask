!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).Watermask=e()}(this,function(){"use strict";var e,t,i,o,a,n,l;function s(t={}){this.settings=Object.assign({text:"watermask",mode:"image",wrapper:document.body,space:5,rotate:-45,fontSize:"16px",fontFamily:"Microsoft YaHei",color:"#DDDDDD",textAlign:"center",verticalAlign:"middle",opacity:1,onSuccess:()=>{},onError:()=>{}},t),`${this.settings.fontSize}`.includes("px")||(console.log("fontSize add px unit"),this.settings.fontSize=`${this.settings.fontSize}px`),this.settings.text?this.init():console.warn("You must provide a text param to create watermask!")}return e=CanvasRenderingContext2D.prototype,n=(n=document.createElement("canvas").getContext("2d")).backingStorePixelRatio||n.webkitBackingStorePixelRatio||n.mozBackingStorePixelRatio||n.msBackingStorePixelRatio||n.oBackingStorePixelRatio||n.backingStorePixelRatio||1,1!=(a=(window.devicePixelRatio||1)/n)&&(function(t,e){for(var i in t)t.hasOwnProperty(i)&&e(t[i],i)}({fillRect:"all",clearRect:"all",strokeRect:"all",moveTo:"all",lineTo:"all",arc:[0,1,2],arcTo:"all",bezierCurveTo:"all",isPointinPath:"all",isPointinStroke:"all",quadraticCurveTo:"all",rect:"all",translate:"all",createRadialGradient:"all",createLinearGradient:"all"},function(o,t){var n;e[t]=(n=e[t],function(){var t,e,i=Array.prototype.slice.call(arguments);if("all"===o)i=i.map(function(t){return t*a});else if(Array.isArray(o))for(t=0,e=o.length;t<e;t++)i[o[t]]*=a;return n.apply(this,i)})}),e.stroke=(t=e.stroke,function(){this.lineWidth*=a,t.apply(this,arguments),this.lineWidth/=a}),e.fillText=(i=e.fillText,function(){var t=Array.prototype.slice.call(arguments);t[1]*=a,t[2]*=a,this.font=this.font.replace(/(\d+)(px|em|rem|pt)/g,function(t,e,i){return e*a+i}),i.apply(this,t),this.font=this.font.replace(/(\d+)(px|em|rem|pt)/g,function(t,e,i){return e/a+i})}),e.strokeText=(o=e.strokeText,function(){var t=Array.prototype.slice.call(arguments);t[1]*=a,t[2]*=a,this.font=this.font.replace(/(\d+)(px|em|rem|pt)/g,function(t,e,i){return e*a+i}),o.apply(this,t),this.font=this.font.replace(/(\d+)(px|em|rem|pt)/g,function(t,e,i){return e/a+i})})),(n=HTMLCanvasElement.prototype).getContext=(l=n.getContext,function(t){var e=l.call(this,t);return"2d"===t&&(t=e.backingStorePixelRatio||e.webkitBackingStorePixelRatio||e.mozBackingStorePixelRatio||e.msBackingStorePixelRatio||e.oBackingStorePixelRatio||e.backingStorePixelRatio||1,1<(t=(window.devicePixelRatio||1)/t)&&(this.style.height=this.height+"px",this.style.width=this.width+"px",this.width*=t,this.height*=t)),e}),s.prototype.init=function(){var{mode:t,text:e}=this.settings,{textWidth:i,textHeight:o,renderWidth:n,renderHeight:a,el:l}=this.getSizeByText(e);this.textWidth=i,this.textHeight=o,this.renderWidth=n,this.renderHeight=a,this.el=l,this.rows=0,this.cols=0,this.data=null,"image"===t?this.createImageByText(e):this.createHtmlByText(e)},s.prototype.getSizeByText=function(t){var{space:e,fontSize:i,fontFamily:o,rotate:n,color:a,textAlign:l,verticalAlign:s}=this.settings;const r=document.createElement("span");r.innerHTML=t,r.style.display="inline-block",r.style.padding=`${e||0}px`,r.style.textAlign=l,r.style.verticalAlign=s,r.style.fontSize=i,r.style.fontFamily=o,r.style.color=a,r.style.opacity=0,r.style.transform=`rotate(${n}deg)`,document.body.appendChild(r);i=r.offsetWidth,o=r.offsetHeight;r.style.width=`${i}px`,r.style.height=`${o}px`;a=r.getBoundingClientRect(),n=a.right-a.left,a=a.bottom-a.top;return document.body.removeChild(r),{textWidth:i,textHeight:o,renderWidth:n,renderHeight:a,el:r}},s.prototype.createImageByText=function(t){const{rotate:e,fontSize:i,fontFamily:o,color:n,textAlign:a,verticalAlign:l,opacity:s,wrapper:r,onSuccess:c}=this.settings,h=document.createElement("canvas"),d=h.getContext("2d");var p=(d.backingStorePixelRatio||d.webkitBackingStorePixelRatio||d.mozBackingStorePixelRatio||d.msBackingStorePixelRatio||d.oBackingStorePixelRatio||d.backingStorePixelRatio||1)/(window.devicePixelRatio||1),g=this.renderWidth*p,y=this.renderHeight*p;h.width=this.width=g,h.height=this.height=y,h.getContext("2d"),d.translate(g/2,y/2),d.rotate(e*Math.PI/180),d.scale(p,p),d.font=`${i} ${o}`,d.fillStyle=n,d.textAlign=a,d.textBaseline=l,d.fillText(t,0,0),this.data=h.toDataURL("image/png",s),r&&(r.style.backgroundImage=`url("${this.data}")`,r.style.backgroundRepeat="repeat",r.style.backgroundPosition="center",r.style.backgroundSize="auto"),c(this.data)},s.prototype.createHtmlByText=function(t){const{opacity:i,space:e,wrapper:o,onSuccess:n}=this.settings;var a=document.body||document.documentElement,l=this.renderWidth+2*e,s=this.renderWidth+2*e,r=Number.parseInt(a.clientWidth/l),a=Number.parseInt(a.clientHeight/s);this.rows=a+2,this.cols=r+2;const c=document.createElement("div");c.className="text-watermask",c.style.position="absolute",c.style.top="0",c.style.left="0",c.style.zIndex=-1,c.style.width="100%",c.style.height="100%",c.style.overflow="hidden";for(let e=-1;e<this.rows-1;e++){var h=l*e;for(let t=-1;t<this.cols-1;t++){var d=s*t;const p=document.createElement("div");p.className="text-watermask-col",p.style.position="absolute",p.style.left=`${d}px`,p.style.top=`${h}px`,p.style.display="flex",p.style.justifyContent="center",p.style.alignItems="center",p.style.width=`${l}px`,p.style.height=`${s}px`,p.setAttribute("data-id",`${e}-${t}`),this.el.style.opacity=i;d=this.el.cloneNode(!0);p.appendChild(d),c.appendChild(p)}}this.data=c,o&&o.appendChild(c),n(this.data)},s});
